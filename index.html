<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="كريم">
    <meta name="description" content="موقعك الإسلامي المتكامل - القرآن الكريم، مواقيت الصلاة، الأذكار، والأدعية">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi2YPYsdmK2YUgLSDZhdmI2YLYudmDINin2YTYpdiz2YTYp9mF2Yog2KfZhNmF2KrZg9in2YXZhCIsInNob3J0X25hbWUiOiLZg9ix2YrZhSIsInN0YXJ0X3VybCI6Ii4vIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzY2N2VlYSIsInRoZW1lX2NvbG9yIjoiIzY2N2VlYSIsIm9yaWVudGF0aW9uIjoicG9ydHJhaXQiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJyUzRSUzQ3RleHQgeT0nLjllbScgZm9udC1zaXplPSc5MCclM0Xwn5SMJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjUxMng1MTIifV19">
    <title>كريم - موقعك الإسلامي المتكامل</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2dd4bf;
            --primary-dark: #14b8a6;
            --secondary: #f0fdfa;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.2);
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }

        body.light-mode {
            --primary: #14b8a6;
            --primary-dark: #0d9488;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(20, 184, 166, 0.2);
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.12);
            --bg-gradient: linear-gradient(135deg, #e0f2fe 0%, #ddd6fe 50%, #fce7f3 100%);
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
            transition: all 0.5s ease;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(45, 212, 191, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }

        .logo {
            font-family: 'Amiri', serif;
            font-size: 3.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(45, 212, 191, 0.3);
            letter-spacing: 2px;
        }

        .tagline {
            font-size: 1.1em;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .hijri-date {
            margin-top: 15px;
            font-size: 1em;
            color: var(--primary);
            font-weight: 500;
            background: rgba(45, 212, 191, 0.1);
            padding: 10px 25px;
            border-radius: 50px;
            display: inline-block;
            border: 1px solid rgba(45, 212, 191, 0.3);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 50%;
            border: 2px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .theme-icon {
            font-size: 1.8em;
            transition: transform 0.4s ease;
        }

        .theme-toggle:active .theme-icon {
            transform: rotate(360deg);
        }

        /* Glass Card */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
            animation: fadeIn 1s ease-out 0.3s backwards;
        }

        .tab-btn {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 14px 28px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            font-family: 'Tajawal', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(45, 212, 191, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .tab-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .tab-btn:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            box-shadow: 0 8px 24px rgba(45, 212, 191, 0.4);
        }

        .tab-btn span {
            position: relative;
            z-index: 1;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeInUp 0.6s ease-out;
        }

        /* Prayer Times Section */
        .prayer-times-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .prayer-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .prayer-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
        }

        .prayer-card:hover::after {
            left: 100%;
        }

        .prayer-card:hover {
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 12px 40px rgba(45, 212, 191, 0.3);
        }

        .prayer-card.next-prayer {
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.3) 0%, rgba(20, 184, 166, 0.2) 100%);
            border: 2px solid var(--primary);
            box-shadow: 0 12px 40px rgba(45, 212, 191, 0.4);
            animation: pulse 2s ease-in-out infinite;
        }

        .prayer-name {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 10px;
            font-family: 'Amiri', serif;
        }

        .prayer-time {
            font-size: 2em;
            font-weight: 800;
            color: var(--primary);
            font-family: 'Tajawal', sans-serif;
            letter-spacing: 1px;
        }

        .remaining-time {
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .location-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            font-weight: 500;
        }

        .btn-get-location {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(45, 212, 191, 0.3);
        }

        .btn-get-location:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.5);
        }

        /* Quran Section */
        .quran-search {
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 18px 25px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 1.1em;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.2);
            background: rgba(255,255,255,0.15);
        }

        .surah-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .surah-grid::-webkit-scrollbar {
            width: 8px;
        }

        .surah-grid::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .surah-grid::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .surah-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .surah-card:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.3);
        }

        .surah-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .surah-name {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'Amiri', serif;
        }

        .surah-translation {
            font-size: 0.85em;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .surah-info {
            margin-top: 8px;
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        /* Quran Player Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .modal-title {
            font-size: 2em;
            font-weight: 700;
            font-family: 'Amiri', serif;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .audio-controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 30px;
        }

        .audio-player {
            width: 100%;
            margin-bottom: 15px;
        }

        .reciter-select {
            width: 100%;
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1em;
            font-family: 'Tajawal', sans-serif;
            cursor: pointer;
        }

        .reciter-select option {
            background: #764ba2;
            color: white;
        }

        .ayat-container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 16px;
            line-height: 2.2;
        }

        .ayah {
            font-family: 'Amiri', serif;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: justify;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border-right: 3px solid var(--primary);
            transition: all 0.3s ease;
        }

        .ayah:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(-5px);
        }

        .ayah-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-size: 0.6em;
            margin-left: 10px;
            font-family: 'Tajawal', sans-serif;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }

        /* Adhkar Section */
        .adhkar-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .adhkar-category-btn {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 20px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1.1em;
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }

        .adhkar-category-btn:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.3);
        }

        .adhkar-category-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
        }

        .adhkar-list {
            display: none;
        }

        .adhkar-list.active {
            display: block;
        }

        .dhikr-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(15px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .dhikr-card:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(-5px);
            border-color: var(--primary);
        }

        .dhikr-text {
            font-family: 'Amiri', serif;
            font-size: 1.6em;
            line-height: 2;
            margin-bottom: 15px;
            text-align: justify;
        }

        .dhikr-translation {
            font-size: 1em;
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-style: italic;
        }

        .dhikr-counter-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .dhikr-count-btn {
            flex: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 700;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(45, 212, 191, 0.3);
        }

        .dhikr-count-btn:active {
            transform: scale(0.95);
        }

        .dhikr-count-btn:hover {
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.5);
        }

        .dhikr-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .count-text {
            font-weight: 700;
            font-size: 1.1em;
        }

        /* Qibla Section */
        .qibla-container {
            text-align: center;
        }

        .compass {
            width: 300px;
            height: 300px;
            margin: 30px auto;
            position: relative;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
            border: 3px solid var(--glass-border);
            box-shadow: 0 0 40px rgba(45, 212, 191, 0.2);
        }

        .compass-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 120px solid var(--primary);
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 0 10px var(--primary));
        }

        .compass-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .compass-direction {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2em;
            font-weight: 700;
            color: var(--primary);
        }

        .qibla-info {
            background: rgba(255,255,255,0.08);
            padding: 25px;
            border-radius: 16px;
            margin-top: 30px;
        }

        .qibla-degree {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--primary);
            margin: 15px 0;
        }

        /* Tasbih Section */
        .tasbih-container {
            text-align: center;
            padding: 40px 20px;
        }

        .tasbih-counter {
            width: 250px;
            height: 250px;
            margin: 30px auto;
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.2) 0%, rgba(20, 184, 166, 0.1) 100%);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 4px solid var(--primary);
            box-shadow: 0 0 50px rgba(45, 212, 191, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tasbih-counter::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .tasbih-counter:active {
            transform: scale(0.95);
        }

        .tasbih-count {
            font-size: 5em;
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
            position: relative;
            z-index: 1;
        }

        .tasbih-label {
            font-size: 1em;
            color: var(--text-secondary);
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }

        .tasbih-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .tasbih-btn {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 15px 35px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
        }

        .tasbih-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.3);
        }

        .tasbih-presets {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .preset-btn {
            background: rgba(255,255,255,0.08);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Amiri', serif;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        .preset-btn.active-preset {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(45, 212, 191, 0.4);
            transform: scale(1.05);
        }

        /* Prayer Tracker Styles */
        .tracker-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.3);
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.95em;
            color: var(--text-secondary);
        }

        .prayer-tracker-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .tracker-prayer-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            padding: 20px 25px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .tracker-prayer-card:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(-5px);
            border-color: var(--primary);
        }

        .tracker-prayer-card.completed {
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.2) 0%, rgba(20, 184, 166, 0.1) 100%);
            border-color: var(--primary);
        }

        .tracker-prayer-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .tracker-prayer-name {
            font-size: 1.3em;
            font-weight: 700;
            font-family: 'Amiri', serif;
        }

        .tracker-prayer-time {
            font-size: 1em;
            color: var(--text-secondary);
        }

        .tracker-checkbox {
            position: relative;
            cursor: pointer;
            user-select: none;
        }

        .tracker-checkbox input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .checkmark {
            display: block;
            width: 35px;
            height: 35px;
            background: rgba(255,255,255,0.1);
            border: 2px solid var(--glass-border);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .tracker-checkbox:hover .checkmark {
            background: rgba(255,255,255,0.15);
            border-color: var(--primary);
        }

        .tracker-checkbox input:checked ~ .checkmark {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 11px;
            top: 6px;
            width: 8px;
            height: 14px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        .tracker-checkbox input:checked ~ .checkmark:after {
            display: block;
        }

        .weekly-progress {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 20px;
            margin-top: 30px;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day-card {
            background: rgba(255,255,255,0.08);
            padding: 15px 10px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .day-card:hover {
            transform: scale(1.05);
        }

        .day-name {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .day-date {
            font-size: 0.75em;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .day-count {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--primary);
        }

        .day-card.full-day {
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.3) 0%, rgba(20, 184, 166, 0.2) 100%);
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(45, 212, 191, 0.3);
        }

        .day-card.full-day .day-count {
            color: white;
        }

        /* Khatmah Styles */
        .khatmah-progress-header {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .khatmah-stat {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
        }

        .khatmah-stat:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .khatmah-stat-number {
            font-size: 2.2em;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .khatmah-stat-label {
            font-size: 0.95em;
            color: var(--text-secondary);
        }

        .progress-bar-large {
            height: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 50px;
            overflow: hidden;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
        }

        .progress-fill-large {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: 700;
            box-shadow: 0 0 20px rgba(45, 212, 191, 0.5);
        }

        .khatmah-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .khatmah-btn {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 15px 35px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
        }

        .khatmah-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .khatmah-btn.primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(45, 212, 191, 0.3);
        }

        .khatmah-btn.primary:hover {
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.5);
        }

        .khatmah-surahs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .khatmah-surah-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .khatmah-surah-card:hover {
            background: rgba(255,255,255,0.12);
            transform: scale(1.05);
        }

        .khatmah-surah-card.completed {
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.3) 0%, rgba(20, 184, 166, 0.2) 100%);
            border-color: var(--primary);
        }

        .khatmah-surah-card.completed::before {
            content: "✓";
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--primary);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
        }

        .khatmah-surah-name {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'Amiri', serif;
        }

        .khatmah-surah-info {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        /* Duaa Styles */
        .duaa-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .duaa-category-btn {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 18px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1em;
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }

        .duaa-category-btn:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .duaa-category-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            color: white;
        }

        .duaa-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .duaa-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(15px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .duaa-card:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(-5px);
            border-color: var(--primary);
        }

        .duaa-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary);
            font-family: 'Amiri', serif;
        }

        .duaa-text {
            font-family: 'Amiri', serif;
            font-size: 1.6em;
            line-height: 2.2;
            margin-bottom: 15px;
            text-align: justify;
        }

        .duaa-translation {
            font-size: 1em;
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-style: italic;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border-right: 3px solid var(--primary);
        }

        .duaa-source {
            font-size: 0.9em;
            color: var(--text-secondary);
            text-align: left;
        }

        .duaa-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .duaa-action-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9em;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
        }

        .duaa-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 12px 40px rgba(45, 212, 191, 0.4);
            }
            50% {
                box-shadow: 0 12px 60px rgba(45, 212, 191, 0.6);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.5em;
            }

            .tab-btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }

            .prayer-times-grid {
                grid-template-columns: 1fr;
            }

            .tracker-stats {
                grid-template-columns: 1fr;
            }

            .week-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
            }

            .day-card {
                padding: 10px 5px;
            }

            .day-name {
                font-size: 0.7em;
            }

            .day-date {
                font-size: 0.65em;
            }

            .day-count {
                font-size: 1.3em;
            }

            .surah-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                max-height: 400px;
            }

            .modal-content {
                padding: 25px;
                width: 95%;
            }

            .ayah {
                font-size: 1.4em;
            }

            .compass {
                width: 250px;
                height: 250px;
            }

            .tasbih-counter {
                width: 200px;
                height: 200px;
            }

            .tasbih-count {
                font-size: 4em;
            }

            .hijri-date {
                font-size: 0.85em;
                padding: 8px 18px;
            }
        }

        .islamic-pattern {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.03;
            pointer-events: none;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.05) 35px, rgba(255,255,255,.05) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(255,255,255,.05) 35px, rgba(255,255,255,.05) 70px);
            z-index: 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(45, 212, 191, 0.4);
            z-index: 2000;
            animation: slideInRight 0.5s ease-out;
            display: none;
            max-width: 350px;
        }

        .notification.show {
            display: block;
        }

        /* Welcome Modal */
        .welcome-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .welcome-modal.show {
            display: flex;
        }

        .welcome-content {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 50px;
            max-width: 500px;
            width: 90%;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .welcome-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-family: 'Amiri', serif;
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .welcome-text {
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
            color: var(--text-secondary);
        }

        .welcome-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 700;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.4);
        }

        .welcome-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(45, 212, 191, 0.6);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .offline-badge {
            display: inline-block;
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-right: 10px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* Help Modal */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
            padding: 20px;
        }

        .help-modal.active {
            display: flex;
        }

        .help-content {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .help-title {
            font-size: 1.8em;
            font-weight: 700;
            font-family: 'Amiri', serif;
        }

        .help-section {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .help-section h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: var(--primary);
            font-family: 'Amiri', serif;
        }

        .help-steps {
            list-style: none;
            padding: 0;
        }

        .help-steps li {
            padding: 12px 0;
            padding-right: 30px;
            position: relative;
            line-height: 1.8;
        }

        .help-steps li:before {
            content: "✓";
            position: absolute;
            right: 0;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2em;
        }

        .manual-location {
            background: rgba(45, 212, 191, 0.2);
            border: 2px dashed var(--primary);
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
        }

        .location-input {
            width: 100%;
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1em;
            font-family: 'Tajawal', sans-serif;
            margin: 10px 0;
        }

        .location-input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .btn-manual-location {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            font-family: 'Tajawal', sans-serif;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .btn-manual-location:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.5);
        }

        .browser-icons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .browser-icon {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .browser-icon span {
            display: block;
            font-size: 2em;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="islamic-pattern"></div>
    <div class="notification" id="notification"></div>
    
    <!-- Help Modal -->
    <div class="help-modal" id="help-modal">
        <div class="help-content">
            <div class="help-header">
                <div>
                    <h2 class="help-title">📍 كيفية تفعيل الموقع</h2>
                </div>
                <button class="close-btn" onclick="closeHelpModal()">×</button>
            </div>

            <div class="help-section">
                <h3>🌐 Chrome / Edge</h3>
                <ul class="help-steps">
                    <li>اضغط على أيقونة القفل 🔒 بجانب عنوان الموقع</li>
                    <li>ابحث عن "الموقع الجغرافي" أو "Location"</li>
                    <li>اختر "السماح" أو "Allow"</li>
                    <li>أعد تحميل الصفحة (F5)</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🧭 Safari (iPhone/iPad)</h3>
                <ul class="help-steps">
                    <li>افتح الإعدادات → Safari</li>
                    <li>اختر "الموقع الجغرافي" أو "Location"</li>
                    <li>فعّل "أثناء استخدام التطبيق"</li>
                    <li>ارجع للموقع واضغط "تحديث الموقع"</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🦊 Firefox</h3>
                <ul class="help-steps">
                    <li>اضغط على أيقونة الإعدادات في شريط العنوان</li>
                    <li>ابحث عن "الأذونات" → "الموقع"</li>
                    <li>اختر "السماح"</li>
                    <li>أعد تحميل الصفحة</li>
                </ul>
            </div>

            <div class="manual-location">
                <h3 style="color: white; margin-bottom: 15px;">🏙️ اختر مدينتك</h3>
                <select class="location-input" id="city-select" onchange="selectCity()" style="cursor: pointer;">
                    <option value="">-- اختر مدينة --</option>
                    <optgroup label="🇪🇬 مصر">
                        <option value="30.0444,31.2357">القاهرة</option>
                        <option value="31.2001,29.9187">الإسكندرية</option>
                        <option value="26.8206,30.8025">أسيوط</option>
                        <option value="30.5965,31.5084">الزقازيق</option>
                        <option value="31.0409,31.3785">المنصورة</option>
                    </optgroup>
                    <optgroup label="🇸🇦 السعودية">
                        <option value="21.4225,39.8262">مكة المكرمة</option>
                        <option value="24.5247,39.5692">المدينة المنورة</option>
                        <option value="24.7136,46.6753">الرياض</option>
                        <option value="21.3891,39.8579">جدة</option>
                        <option value="26.4207,50.0888">الدمام</option>
                    </optgroup>
                    <optgroup label="🇦🇪 الإمارات">
                        <option value="25.2048,55.2708">دبي</option>
                        <option value="24.4539,54.3773">أبو ظبي</option>
                        <option value="25.3463,55.4209">الشارقة</option>
                    </optgroup>
                    <optgroup label="🇯🇴 الأردن">
                        <option value="31.9454,35.9284">عمّان</option>
                        <option value="32.5556,35.8469">إربد</option>
                    </optgroup>
                    <optgroup label="🇱🇧 لبنان">
                        <option value="33.8938,35.5018">بيروت</option>
                    </optgroup>
                    <optgroup label="🇰🇼 الكويت">
                        <option value="29.3759,47.9774">الكويت</option>
                    </optgroup>
                    <optgroup label="🇶🇦 قطر">
                        <option value="25.2854,51.5310">الدوحة</option>
                    </optgroup>
                    <optgroup label="🇧🇭 البحرين">
                        <option value="26.0667,50.5577">المنامة</option>
                    </optgroup>
                    <optgroup label="🇴🇲 عمان">
                        <option value="23.5880,58.3829">مسقط</option>
                    </optgroup>
                    <optgroup label="🇾🇪 اليمن">
                        <option value="15.5527,48.5164">صنعاء</option>
                        <option value="12.7855,45.0187">عدن</option>
                    </optgroup>
                    <optgroup label="🇮🇶 العراق">
                        <option value="33.3152,44.3661">بغداد</option>
                        <option value="36.3400,43.1300">الموصل</option>
                    </optgroup>
                    <optgroup label="🇸🇾 سوريا">
                        <option value="33.5138,36.2765">دمشق</option>
                        <option value="36.2021,37.1343">حلب</option>
                    </optgroup>
                    <optgroup label="🇵🇸 فلسطين">
                        <option value="31.9522,35.2332">القدس</option>
                        <option value="31.5017,34.4668">غزة</option>
                    </optgroup>
                    <optgroup label="🇲🇦 المغرب">
                        <option value="33.5731,7.5898">الدار البيضاء</option>
                        <option value="34.0209,6.8416">الرباط</option>
                    </optgroup>
                    <optgroup label="🇩🇿 الجزائر">
                        <option value="36.7538,3.0588">الجزائر</option>
                        <option value="36.1907,5.4041">بجاية</option>
                    </optgroup>
                    <optgroup label="🇹🇳 تونس">
                        <option value="36.8065,10.1815">تونس</option>
                    </optgroup>
                    <optgroup label="🇱🇾 ليبيا">
                        <option value="32.8872,13.1913">طرابلس</option>
                        <option value="32.1192,20.0685">بنغازي</option>
                    </optgroup>
                    <optgroup label="🇸🇩 السودان">
                        <option value="15.5007,32.5599">الخرطوم</option>
                    </optgroup>
                    <optgroup label="🇹🇷 تركيا">
                        <option value="41.0082,28.9784">إسطنبول</option>
                        <option value="39.9334,32.8597">أنقرة</option>
                    </optgroup>
                </select>
                
                <div style="margin: 20px 0; text-align: center; color: rgba(255,255,255,0.6);">أو</div>
                
                <h3 style="color: white; margin-bottom: 15px;">📝 أدخل موقعك يدوياً</h3>
                <p style="font-size: 0.9em; color: rgba(255,255,255,0.8); margin-bottom: 15px;">
                    يمكنك الحصول على إحداثياتك من <a href="https://www.latlong.net/" target="_blank" style="color: var(--primary); text-decoration: underline;">هنا</a>
                </p>
                <input type="number" step="0.0001" class="location-input" id="manual-lat" placeholder="خط العرض (مثال: 31.2001)">
                <input type="number" step="0.0001" class="location-input" id="manual-lng" placeholder="خط الطول (مثال: 29.9187)">
                <button class="btn-manual-location" onclick="useManualLocation()">استخدام هذا الموقع</button>
            </div>

            <div style="margin-top: 30px; text-align: center; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                <p style="font-size: 0.95em; line-height: 1.8;">
                    💡 <strong>ملاحظة:</strong> نحن لا نحفظ أو نشارك موقعك مع أي جهة.<br>
                    الموقع يُستخدم فقط لحساب مواقيت الصلاة واتجاه القبلة.
                </p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header class="header">
            <div class="theme-toggle" onclick="toggleTheme()" title="تبديل الوضع الليلي/النهاري">
                <span class="theme-icon">🌙</span>
            </div>
            <h1 class="logo">كريم</h1>
            <p class="tagline">موقعك الإسلامي المتكامل • القرآن • الأذكار • مواقيت الصلاة</p>
            <div class="hijri-date" id="hijri-date">📅 جاري تحميل التاريخ الهجري...</div>
        </header>

        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="prayer"><span>⏰ مواقيت الصلاة</span></button>
            <button class="tab-btn" data-tab="tracker"><span>📊 متابعة الصلوات</span></button>
            <button class="tab-btn" data-tab="quran"><span>📖 القرآن الكريم</span></button>
            <button class="tab-btn" data-tab="khatmah"><span>📗 ختمة القرآن</span></button>
            <button class="tab-btn" data-tab="duaa"><span>🤲 الأدعية</span></button>
            <button class="tab-btn" data-tab="adhkar"><span>💎 الأذكار</span></button>
            <button class="tab-btn" data-tab="qibla"><span>🧭 القبلة</span></button>
            <button class="tab-btn" data-tab="tasbih"><span>📿 المسبحة</span></button>
        </nav>

        <!-- Prayer Times Tab -->
        <div class="tab-content active" id="prayer">
            <div class="glass-card">
                <div class="location-info">
                    <span id="location-text">📍 جاري تحديد موقعك...</span>
                    <button class="btn-get-location" onclick="getPrayerTimes()">تحديث الموقع</button>
                </div>
                <div class="prayer-times-grid" id="prayer-times-grid">
                    <!-- Prayer times will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Prayer Tracker Tab -->
        <div class="tab-content" id="tracker">
            <div class="glass-card">
                <h2 style="text-align: center; margin-bottom: 30px; font-family: 'Amiri', serif; font-size: 2em;">📊 متابعة صلواتك اليومية</h2>
                
                <div class="tracker-stats">
                    <div class="stat-card">
                        <div class="stat-icon">✅</div>
                        <div class="stat-number" id="prayed-count">0</div>
                        <div class="stat-label">صلوات مؤداة</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">⏳</div>
                        <div class="stat-number" id="remaining-count">5</div>
                        <div class="stat-label">صلوات متبقية</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📈</div>
                        <div class="stat-number" id="streak-count">0</div>
                        <div class="stat-label">أيام متواصلة</div>
                    </div>
                </div>

                <div class="prayer-tracker-list">
                    <div class="tracker-prayer-card" data-prayer="fajr">
                        <div class="tracker-prayer-info">
                            <div class="tracker-prayer-name">🌅 الفجر</div>
                            <div class="tracker-prayer-time" id="tracker-fajr-time">--:--</div>
                        </div>
                        <label class="tracker-checkbox">
                            <input type="checkbox" onchange="updatePrayerTracker('fajr', this.checked)">
                            <span class="checkmark"></span>
                        </label>
                    </div>

                    <div class="tracker-prayer-card" data-prayer="dhuhr">
                        <div class="tracker-prayer-info">
                            <div class="tracker-prayer-name">☀️ الظهر</div>
                            <div class="tracker-prayer-time" id="tracker-dhuhr-time">--:--</div>
                        </div>
                        <label class="tracker-checkbox">
                            <input type="checkbox" onchange="updatePrayerTracker('dhuhr', this.checked)">
                            <span class="checkmark"></span>
                        </label>
                    </div>

                    <div class="tracker-prayer-card" data-prayer="asr">
                        <div class="tracker-prayer-info">
                            <div class="tracker-prayer-name">🌤️ العصر</div>
                            <div class="tracker-prayer-time" id="tracker-asr-time">--:--</div>
                        </div>
                        <label class="tracker-checkbox">
                            <input type="checkbox" onchange="updatePrayerTracker('asr', this.checked)">
                            <span class="checkmark"></span>
                        </label>
                    </div>

                    <div class="tracker-prayer-card" data-prayer="maghrib">
                        <div class="tracker-prayer-info">
                            <div class="tracker-prayer-name">🌆 المغرب</div>
                            <div class="tracker-prayer-time" id="tracker-maghrib-time">--:--</div>
                        </div>
                        <label class="tracker-checkbox">
                            <input type="checkbox" onchange="updatePrayerTracker('maghrib', this.checked)">
                            <span class="checkmark"></span>
                        </label>
                    </div>

                    <div class="tracker-prayer-card" data-prayer="isha">
                        <div class="tracker-prayer-info">
                            <div class="tracker-prayer-name">🌙 العشاء</div>
                            <div class="tracker-prayer-time" id="tracker-isha-time">--:--</div>
                        </div>
                        <label class="tracker-checkbox">
                            <input type="checkbox" onchange="updatePrayerTracker('isha', this.checked)">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                </div>

                <div class="weekly-progress">
                    <h3 style="text-align: center; margin: 30px 0 20px; font-family: 'Amiri', serif;">📅 آخر 7 أيام</h3>
                    <div class="week-grid" id="week-grid">
                        <!-- Week grid will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Quran Tab -->
        <div class="tab-content" id="quran">
            <div class="glass-card">
                <div class="quran-search">
                    <input type="text" class="search-input" id="surah-search" placeholder="🔍 ابحث عن سورة..." oninput="filterSurahs()">
                </div>
                <div class="surah-grid" id="surah-grid">
                    <!-- Surahs will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Khatmah Tab -->
        <div class="tab-content" id="khatmah">
            <div class="glass-card">
                <h2 style="text-align: center; margin-bottom: 30px; font-family: 'Amiri', serif; font-size: 2em;">📗 ختمة القرآن الكريم</h2>
                
                <div class="khatmah-progress-header">
                    <div class="khatmah-stat">
                        <div class="khatmah-stat-number" id="khatmah-percent">0%</div>
                        <div class="khatmah-stat-label">نسبة الإنجاز</div>
                    </div>
                    <div class="khatmah-stat">
                        <div class="khatmah-stat-number" id="khatmah-completed">0/114</div>
                        <div class="khatmah-stat-label">السور المكتملة</div>
                    </div>
                    <div class="khatmah-stat">
                        <div class="khatmah-stat-number" id="khatmah-pages">0/604</div>
                        <div class="khatmah-stat-label">الصفحات</div>
                    </div>
                </div>

                <div class="progress-bar-large">
                    <div class="progress-fill-large" id="khatmah-progress-fill"></div>
                </div>

                <div class="khatmah-actions">
                    <button class="khatmah-btn" onclick="resetKhatmah()">🔄 ختمة جديدة</button>
                    <button class="khatmah-btn primary" onclick="shareKhatmah()">📸 مشاركة التقدم</button>
                </div>

                <div class="khatmah-surahs-grid" id="khatmah-grid">
                    <!-- Khatmah surahs will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Duaa Tab -->
        <div class="tab-content" id="duaa">
            <div class="glass-card">
                <h2 style="text-align: center; margin-bottom: 30px; font-family: 'Amiri', serif; font-size: 2em;">🤲 الأدعية المأثورة</h2>
                
                <div class="duaa-categories">
                    <button class="duaa-category-btn active" onclick="showDuaaCategory('daily')">أدعية يومية</button>
                    <button class="duaa-category-btn" onclick="showDuaaCategory('quran')">أدعية القرآن</button>
                    <button class="duaa-category-btn" onclick="showDuaaCategory('prophet')">أدعية النبي ﷺ</button>
                    <button class="duaa-category-btn" onclick="showDuaaCategory('special')">أدعية مناسبات</button>
                </div>

                <div id="duaa-content" class="duaa-list">
                    <!-- Duaa will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Quran Player Modal -->
        <div class="modal" id="quran-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h2 class="modal-title" id="modal-surah-name"></h2>
                        <p class="surah-translation" id="modal-surah-info"></p>
                    </div>
                    <button class="close-btn" onclick="closeQuranModal()">×</button>
                </div>
                <div class="audio-controls">
                    <audio id="quran-audio" class="audio-player" controls></audio>
                    <select class="reciter-select" id="reciter-select" onchange="changeReciter()">
                        <option value="ar.alafasy">مشاري العفاسي</option>
                        <option value="ar.abdulbasitmurattal">عبد الباسط عبد الصمد</option>
                        <option value="ar.husary">محمود خليل الحصري</option>
                        <option value="ar.minshawi">محمد صديق المنشاوي</option>
                        <option value="ar.shaatree">أبو بكر الشاطري</option>
                    </select>
                </div>
                <div class="ayat-container" id="ayat-container">
                    <div class="loading">جاري التحميل...</div>
                </div>
            </div>
        </div>

        <!-- Adhkar Tab -->
        <div class="tab-content" id="adhkar">
            <div class="glass-card">
                <div class="adhkar-categories">
                    <button class="adhkar-category-btn active" onclick="showAdhkar('morning')">أذكار الصباح</button>
                    <button class="adhkar-category-btn" onclick="showAdhkar('evening')">أذكار المساء</button>
                    <button class="adhkar-category-btn" onclick="showAdhkar('sleep')">أذكار النوم</button>
                    <button class="adhkar-category-btn" onclick="showAdhkar('after-prayer')">أذكار بعد الصلاة</button>
                </div>
                <div id="adhkar-content">
                    <!-- Adhkar will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Qibla Tab -->
        <div class="tab-content" id="qibla">
            <div class="glass-card">
                <div class="qibla-container">
                    <h2>🧭 اتجاه القبلة</h2>
                    <div class="compass" id="compass">
                        <div class="compass-inner" id="compass-inner">
                            <div class="compass-direction">N</div>
                            <div class="compass-needle"></div>
                            <div class="compass-center"></div>
                        </div>
                    </div>
                    <div class="qibla-info">
                        <p>الاتجاه للقبلة</p>
                        <div class="qibla-degree" id="qibla-degree">---°</div>
                        <button class="btn-get-location" onclick="findQibla()">تحديد القبلة</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasbih Tab -->
        <div class="tab-content" id="tasbih">
            <div class="glass-card">
                <div class="tasbih-container">
                    <h2>📿 المسبحة الإلكترونية</h2>
                    <div class="tasbih-counter" onclick="incrementTasbih()">
                        <div class="tasbih-count" id="tasbih-count">0</div>
                        <div class="tasbih-label" id="tasbih-label">سبحان الله</div>
                    </div>
                    <div class="tasbih-controls">
                        <button class="tasbih-btn" onclick="resetTasbih()">إعادة تعيين</button>
                    </div>
                    <div class="tasbih-presets">
                        <button class="preset-btn active-preset" onclick="setTasbihText('سبحان الله')">سبحان الله</button>
                        <button class="preset-btn" onclick="setTasbihText('الحمد لله')">الحمد لله</button>
                        <button class="preset-btn" onclick="setTasbihText('الله أكبر')">الله أكبر</button>
                        <button class="preset-btn" onclick="setTasbihText('لا إله إلا الله')">لا إله إلا الله</button>
                        <button class="preset-btn" onclick="setTasbihText('استغفر الله')">استغفر الله</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentSurahNumber = 1;
        let currentReciter = 'ar.alafasy';
        let tasbihCount = 0;
        let currentDhikrText = 'سبحان الله';

        // Tab Switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                btn.classList.add('active');
                document.getElementById(tabName).classList.add('active');
            });
        });

        // Prayer Times Functions
        async function getPrayerTimes() {
            if (!navigator.geolocation) {
                showNotification('❌ المتصفح لا يدعم تحديد الموقع');
                return;
            }

            const locationText = document.getElementById('location-text');
            locationText.innerHTML = '⏳ جاري تحديد موقعك...';

            navigator.geolocation.getCurrentPosition(async (position) => {
                const { latitude, longitude } = position.coords;
                
                // Update location text
                locationText.innerHTML = `📍 ${latitude.toFixed(4)}° , ${longitude.toFixed(4)}°`;

                // Calculate prayer times using Aladhan API
                const date = new Date();
                const dateStr = `${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}`;
                
                try {
                    const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${latitude}&longitude=${longitude}&method=5`;
                    console.log('Fetching prayer times from:', url);
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    console.log('Prayer times response:', data);
                    
                    if (data.code === 200) {
                        const timings = data.data.timings;
                        displayPrayerTimes(timings);
                        
                        // Cache prayer times
                        localStorage.setItem('prayerTimes', JSON.stringify(timings));
                        localStorage.setItem('prayerTimesDate', dateStr);
                        localStorage.setItem('prayerLocation', `${latitude},${longitude}`);
                        
                        showNotification('✅ تم تحديث مواقيت الصلاة بنجاح');
                    }
                } catch (error) {
                    console.error('Error fetching prayer times:', error);
                    // Load from cache if available
                    const cached = localStorage.getItem('prayerTimes');
                    if (cached) {
                        displayPrayerTimes(JSON.parse(cached));
                        showNotification('⚠️ تم تحميل آخر مواقيت محفوظة (خطأ في الاتصال)');
                    } else {
                        showNotification('❌ فشل تحميل مواقيت الصلاة');
                        locationText.innerHTML = '❌ فشل تحديد الموقع - حاول مرة أخرى';
                    }
                }
            }, (error) => {
                console.error('Geolocation error:', error);
                let errorMsg = 'يرجى السماح بالوصول للموقع';
                
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMsg = '❌ تم رفض الوصول للموقع';
                        // Show help modal
                        showHelpModal();
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMsg = '❌ الموقع غير متاح';
                        break;
                    case error.TIMEOUT:
                        errorMsg = '⏱️ انتهت مهلة تحديد الموقع';
                        break;
                }
                
                showNotification(errorMsg);
                locationText.innerHTML = errorMsg + ' <button onclick="showHelpModal()" style="background: var(--primary); border: none; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; margin-right: 10px; font-family: \'Tajawal\', sans-serif;">كيف أفعّله؟</button>';
                
                // Try to load cached data
                const cached = localStorage.getItem('prayerTimes');
                if (cached) {
                    displayPrayerTimes(JSON.parse(cached));
                    const cachedLocation = localStorage.getItem('prayerLocation');
                    if (cachedLocation) {
                        locationText.innerHTML += `<br><small style="color: rgba(255,255,255,0.6);">📍 ${cachedLocation} (محفوظ)</small>`;
                    }
                }
            }, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            });
        }

        function displayPrayerTimes(timings) {
            const prayerNames = {
                'Fajr': 'الفجر',
                'Dhuhr': 'الظهر',
                'Asr': 'العصر',
                'Maghrib': 'المغرب',
                'Isha': 'العشاء'
            };

            const grid = document.getElementById('prayer-times-grid');
            grid.innerHTML = '';

            const now = new Date();
            let nextPrayer = null;
            let minDiff = Infinity;

            Object.entries(prayerNames).forEach(([key, name]) => {
                const time = timings[key];
                const [hours, minutes] = time.split(':');
                const prayerTime = new Date();
                prayerTime.setHours(parseInt(hours), parseInt(minutes), 0);

                const diff = prayerTime - now;
                if (diff > 0 && diff < minDiff) {
                    minDiff = diff;
                    nextPrayer = key;
                }

                const card = document.createElement('div');
                card.className = 'prayer-card';
                if (key === nextPrayer) {
                    card.classList.add('next-prayer');
                    const remaining = formatTimeRemaining(diff);
                    card.innerHTML = `
                        <div class="prayer-name">${name}</div>
                        <div class="prayer-time">${time}</div>
                        <div class="remaining-time">متبقي: ${remaining}</div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="prayer-name">${name}</div>
                        <div class="prayer-time">${time}</div>
                    `;
                }
                grid.appendChild(card);
            });

            // Sync tracker times
            syncTrackerTimes(timings);

            // Set notification for next prayer
            if (nextPrayer && minDiff > 0) {
                setTimeout(() => {
                    playAdhan();
                    showNotification(`🕌 حان الآن موعد صلاة ${prayerNames[nextPrayer]}`);
                }, minDiff);
            }
        }

        function formatTimeRemaining(ms) {
            const hours = Math.floor(ms / (1000 * 60 * 60));
            const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
            return `${hours}س ${minutes}د`;
        }

        function playAdhan() {
            // Create audio context for adhan sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Play notification sequence
            const notes = [
                {freq: 659, duration: 0.3}, // E
                {freq: 659, duration: 0.3}, // E
                {freq: 698, duration: 0.3}, // F
                {freq: 784, duration: 0.6}, // G
                {freq: 698, duration: 0.3}, // F
                {freq: 659, duration: 0.3}, // E
                {freq: 587, duration: 0.6}  // D
            ];
            
            let currentTime = audioContext.currentTime;
            
            notes.forEach((note, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = note.freq;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, currentTime + note.duration);
                
                oscillator.start(currentTime);
                oscillator.stop(currentTime + note.duration);
                
                currentTime += note.duration;
            });
            
            // Request notification permission if not granted
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // Show browser notification
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('🕌 موعد الصلاة', {
                    body: 'حان الآن موعد الصلاة',
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">🕌</text></svg>',
                    requireInteraction: true
                });
            }
            
            // Vibrate if supported
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }

        // Quran Functions
        const surahs = [
            {number: 1, name: 'الفاتحة', translation: 'The Opening', verses: 7, revelation: 'مكية'},
            {number: 2, name: 'البقرة', translation: 'The Cow', verses: 286, revelation: 'مدنية'},
            {number: 3, name: 'آل عمران', translation: 'Family of Imran', verses: 200, revelation: 'مدنية'},
            {number: 4, name: 'النساء', translation: 'The Women', verses: 176, revelation: 'مدنية'},
            {number: 5, name: 'المائدة', translation: 'The Table Spread', verses: 120, revelation: 'مدنية'},
            {number: 6, name: 'الأنعام', translation: 'The Cattle', verses: 165, revelation: 'مكية'},
            {number: 7, name: 'الأعراف', translation: 'The Heights', verses: 206, revelation: 'مكية'},
            {number: 8, name: 'الأنفال', translation: 'The Spoils of War', verses: 75, revelation: 'مدنية'},
            {number: 9, name: 'التوبة', translation: 'The Repentance', verses: 129, revelation: 'مدنية'},
            {number: 10, name: 'يونس', translation: 'Jonah', verses: 109, revelation: 'مكية'},
            {number: 11, name: 'هود', translation: 'Hud', verses: 123, revelation: 'مكية'},
            {number: 12, name: 'يوسف', translation: 'Joseph', verses: 111, revelation: 'مكية'},
            {number: 13, name: 'الرعد', translation: 'The Thunder', verses: 43, revelation: 'مدنية'},
            {number: 14, name: 'ابراهيم', translation: 'Abraham', verses: 52, revelation: 'مكية'},
            {number: 15, name: 'الحجر', translation: 'The Rocky Tract', verses: 99, revelation: 'مكية'},
            {number: 16, name: 'النحل', translation: 'The Bee', verses: 128, revelation: 'مكية'},
            {number: 17, name: 'الإسراء', translation: 'The Night Journey', verses: 111, revelation: 'مكية'},
            {number: 18, name: 'الكهف', translation: 'The Cave', verses: 110, revelation: 'مكية'},
            {number: 19, name: 'مريم', translation: 'Mary', verses: 98, revelation: 'مكية'},
            {number: 20, name: 'طه', translation: 'Ta-Ha', verses: 135, revelation: 'مكية'},
            {number: 21, name: 'الأنبياء', translation: 'The Prophets', verses: 112, revelation: 'مكية'},
            {number: 22, name: 'الحج', translation: 'The Pilgrimage', verses: 78, revelation: 'مدنية'},
            {number: 23, name: 'المؤمنون', translation: 'The Believers', verses: 118, revelation: 'مكية'},
            {number: 24, name: 'النور', translation: 'The Light', verses: 64, revelation: 'مدنية'},
            {number: 25, name: 'الفرقان', translation: 'The Criterion', verses: 77, revelation: 'مكية'},
            {number: 26, name: 'الشعراء', translation: 'The Poets', verses: 227, revelation: 'مكية'},
            {number: 27, name: 'النمل', translation: 'The Ant', verses: 93, revelation: 'مكية'},
            {number: 28, name: 'القصص', translation: 'The Stories', verses: 88, revelation: 'مكية'},
            {number: 29, name: 'العنكبوت', translation: 'The Spider', verses: 69, revelation: 'مكية'},
            {number: 30, name: 'الروم', translation: 'The Romans', verses: 60, revelation: 'مكية'},
            {number: 31, name: 'لقمان', translation: 'Luqman', verses: 34, revelation: 'مكية'},
            {number: 32, name: 'السجدة', translation: 'The Prostration', verses: 30, revelation: 'مكية'},
            {number: 33, name: 'الأحزاب', translation: 'The Clans', verses: 73, revelation: 'مدنية'},
            {number: 34, name: 'سبأ', translation: 'Sheba', verses: 54, revelation: 'مكية'},
            {number: 35, name: 'فاطر', translation: 'Originator', verses: 45, revelation: 'مكية'},
            {number: 36, name: 'يس', translation: 'Ya Sin', verses: 83, revelation: 'مكية'},
            {number: 37, name: 'الصافات', translation: 'Those Ranges in Ranks', verses: 182, revelation: 'مكية'},
            {number: 38, name: 'ص', translation: 'The Letter Saad', verses: 88, revelation: 'مكية'},
            {number: 39, name: 'الزمر', translation: 'The Troops', verses: 75, revelation: 'مكية'},
            {number: 40, name: 'غافر', translation: 'The Forgiver', verses: 85, revelation: 'مكية'},
            {number: 41, name: 'فصلت', translation: 'Explained in Detail', verses: 54, revelation: 'مكية'},
            {number: 42, name: 'الشورى', translation: 'The Consultation', verses: 53, revelation: 'مكية'},
            {number: 43, name: 'الزخرف', translation: 'The Ornaments of Gold', verses: 89, revelation: 'مكية'},
            {number: 44, name: 'الدخان', translation: 'The Smoke', verses: 59, revelation: 'مكية'},
            {number: 45, name: 'الجاثية', translation: 'The Crouching', verses: 37, revelation: 'مكية'},
            {number: 46, name: 'الأحقاف', translation: 'The Wind-Curved Sandhills', verses: 35, revelation: 'مكية'},
            {number: 47, name: 'محمد', translation: 'Muhammad', verses: 38, revelation: 'مدنية'},
            {number: 48, name: 'الفتح', translation: 'The Victory', verses: 29, revelation: 'مدنية'},
            {number: 49, name: 'الحجرات', translation: 'The Rooms', verses: 18, revelation: 'مدنية'},
            {number: 50, name: 'ق', translation: 'The Letter Qaf', verses: 45, revelation: 'مكية'},
            {number: 51, name: 'الذاريات', translation: 'The Winnowing Winds', verses: 60, revelation: 'مكية'},
            {number: 52, name: 'الطور', translation: 'The Mount', verses: 49, revelation: 'مكية'},
            {number: 53, name: 'النجم', translation: 'The Star', verses: 62, revelation: 'مكية'},
            {number: 54, name: 'القمر', translation: 'The Moon', verses: 55, revelation: 'مكية'},
            {number: 55, name: 'الرحمن', translation: 'The Beneficent', verses: 78, revelation: 'مدنية'},
            {number: 56, name: 'الواقعة', translation: 'The Inevitable', verses: 96, revelation: 'مكية'},
            {number: 57, name: 'الحديد', translation: 'The Iron', verses: 29, revelation: 'مدنية'},
            {number: 58, name: 'المجادلة', translation: 'The Pleading Woman', verses: 22, revelation: 'مدنية'},
            {number: 59, name: 'الحشر', translation: 'The Exile', verses: 24, revelation: 'مدنية'},
            {number: 60, name: 'الممتحنة', translation: 'She that is to be examined', verses: 13, revelation: 'مدنية'},
            {number: 61, name: 'الصف', translation: 'The Ranks', verses: 14, revelation: 'مدنية'},
            {number: 62, name: 'الجمعة', translation: 'Friday', verses: 11, revelation: 'مدنية'},
            {number: 63, name: 'المنافقون', translation: 'The Hypocrites', verses: 11, revelation: 'مدنية'},
            {number: 64, name: 'التغابن', translation: 'The Mutual Disillusion', verses: 18, revelation: 'مدنية'},
            {number: 65, name: 'الطلاق', translation: 'The Divorce', verses: 12, revelation: 'مدنية'},
            {number: 66, name: 'التحريم', translation: 'The Prohibition', verses: 12, revelation: 'مدنية'},
            {number: 67, name: 'الملك', translation: 'The Sovereignty', verses: 30, revelation: 'مكية'},
            {number: 68, name: 'القلم', translation: 'The Pen', verses: 52, revelation: 'مكية'},
            {number: 69, name: 'الحاقة', translation: 'The Reality', verses: 52, revelation: 'مكية'},
            {number: 70, name: 'المعارج', translation: 'The Ascending Stairways', verses: 44, revelation: 'مكية'},
            {number: 71, name: 'نوح', translation: 'Noah', verses: 28, revelation: 'مكية'},
            {number: 72, name: 'الجن', translation: 'The Jinn', verses: 28, revelation: 'مكية'},
            {number: 73, name: 'المزمل', translation: 'The Enshrouded One', verses: 20, revelation: 'مكية'},
            {number: 74, name: 'المدثر', translation: 'The Cloaked One', verses: 56, revelation: 'مكية'},
            {number: 75, name: 'القيامة', translation: 'The Resurrection', verses: 40, revelation: 'مكية'},
            {number: 76, name: 'الانسان', translation: 'The Man', verses: 31, revelation: 'مدنية'},
            {number: 77, name: 'المرسلات', translation: 'The Emissaries', verses: 50, revelation: 'مكية'},
            {number: 78, name: 'النبأ', translation: 'The Tidings', verses: 40, revelation: 'مكية'},
            {number: 79, name: 'النازعات', translation: 'Those who drag forth', verses: 46, revelation: 'مكية'},
            {number: 80, name: 'عبس', translation: 'He frowned', verses: 42, revelation: 'مكية'},
            {number: 81, name: 'التكوير', translation: 'The Overthrowing', verses: 29, revelation: 'مكية'},
            {number: 82, name: 'الإنفطار', translation: 'The Cleaving', verses: 19, revelation: 'مكية'},
            {number: 83, name: 'المطففين', translation: 'The Defrauding', verses: 36, revelation: 'مكية'},
            {number: 84, name: 'الإنشقاق', translation: 'The Sundering', verses: 25, revelation: 'مكية'},
            {number: 85, name: 'البروج', translation: 'The Mansions of Stars', verses: 22, revelation: 'مكية'},
            {number: 86, name: 'الطارق', translation: 'The Nightcommer', verses: 17, revelation: 'مكية'},
            {number: 87, name: 'الأعلى', translation: 'The Most High', verses: 19, revelation: 'مكية'},
            {number: 88, name: 'الغاشية', translation: 'The Overwhelming', verses: 26, revelation: 'مكية'},
            {number: 89, name: 'الفجر', translation: 'The Dawn', verses: 30, revelation: 'مكية'},
            {number: 90, name: 'البلد', translation: 'The City', verses: 20, revelation: 'مكية'},
            {number: 91, name: 'الشمس', translation: 'The Sun', verses: 15, revelation: 'مكية'},
            {number: 92, name: 'الليل', translation: 'The Night', verses: 21, revelation: 'مكية'},
            {number: 93, name: 'الضحى', translation: 'The Morning Hours', verses: 11, revelation: 'مكية'},
            {number: 94, name: 'الشرح', translation: 'The Relief', verses: 8, revelation: 'مكية'},
            {number: 95, name: 'التين', translation: 'The Fig', verses: 8, revelation: 'مكية'},
            {number: 96, name: 'العلق', translation: 'The Clot', verses: 19, revelation: 'مكية'},
            {number: 97, name: 'القدر', translation: 'The Power', verses: 5, revelation: 'مكية'},
            {number: 98, name: 'البينة', translation: 'The Clear Proof', verses: 8, revelation: 'مدنية'},
            {number: 99, name: 'الزلزلة', translation: 'The Earthquake', verses: 8, revelation: 'مدنية'},
            {number: 100, name: 'العاديات', translation: 'The Chargers', verses: 11, revelation: 'مكية'},
            {number: 101, name: 'القارعة', translation: 'The Calamity', verses: 11, revelation: 'مكية'},
            {number: 102, name: 'التكاثر', translation: 'The Rivalry in world increase', verses: 8, revelation: 'مكية'},
            {number: 103, name: 'العصر', translation: 'The Declining Day', verses: 3, revelation: 'مكية'},
            {number: 104, name: 'الهمزة', translation: 'The Traducer', verses: 9, revelation: 'مكية'},
            {number: 105, name: 'الفيل', translation: 'The Elephant', verses: 5, revelation: 'مكية'},
            {number: 106, name: 'قريش', translation: 'Quraysh', verses: 4, revelation: 'مكية'},
            {number: 107, name: 'الماعون', translation: 'The Small kindnesses', verses: 7, revelation: 'مكية'},
            {number: 108, name: 'الكوثر', translation: 'The Abundance', verses: 3, revelation: 'مكية'},
            {number: 109, name: 'الكافرون', translation: 'The Disbelievers', verses: 6, revelation: 'مكية'},
            {number: 110, name: 'النصر', translation: 'The Divine Support', verses: 3, revelation: 'مدنية'},
            {number: 111, name: 'المسد', translation: 'The Palm Fibre', verses: 5, revelation: 'مكية'},
            {number: 112, name: 'الإخلاص', translation: 'The Sincerity', verses: 4, revelation: 'مكية'},
            {number: 113, name: 'الفلق', translation: 'The Daybreak', verses: 5, revelation: 'مكية'},
            {number: 114, name: 'الناس', translation: 'Mankind', verses: 6, revelation: 'مكية'}
        ];

        function displaySurahs() {
            const grid = document.getElementById('surah-grid');
            grid.innerHTML = '';
            
            surahs.forEach(surah => {
                const card = document.createElement('div');
                card.className = 'surah-card';
                card.onclick = () => openQuranModal(surah.number);
                card.innerHTML = `
                    <div class="surah-number">${surah.number}</div>
                    <div class="surah-name">${surah.name}</div>
                    <div class="surah-translation">${surah.translation}</div>
                    <div class="surah-info">${surah.verses} آية • ${surah.revelation}</div>
                `;
                grid.appendChild(card);
            });
        }

        function filterSurahs() {
            const searchTerm = document.getElementById('surah-search').value.toLowerCase();
            const cards = document.querySelectorAll('.surah-card');
            
            cards.forEach((card, index) => {
                const surah = surahs[index];
                const matches = surah.name.includes(searchTerm) || 
                               surah.translation.toLowerCase().includes(searchTerm) ||
                               surah.number.toString().includes(searchTerm);
                card.style.display = matches ? 'block' : 'none';
            });
        }

        async function openQuranModal(surahNumber) {
            currentSurahNumber = surahNumber;
            const modal = document.getElementById('quran-modal');
            const surah = surahs[surahNumber - 1];
            
            document.getElementById('modal-surah-name').textContent = surah.name;
            document.getElementById('modal-surah-info').textContent = `${surah.translation} • ${surah.verses} آية • ${surah.revelation}`;
            
            modal.classList.add('active');
            
            // Show loading for audio
            showNotification('⏳ جاري تحميل الصوت...');
            
            // Load audio
            updateAudioSource();
            
            // Load ayat text
            await loadSurahText(surahNumber);
        }

        function closeQuranModal() {
            const modal = document.getElementById('quran-modal');
            modal.classList.remove('active');
            const audio = document.getElementById('quran-audio');
            audio.pause();
        }

        function updateAudioSource() {
            const audio = document.getElementById('quran-audio');
            const surahNum = String(currentSurahNumber).padStart(3, '0');
            
            // Map reciter codes to correct API endpoints
            const reciterMap = {
                'ar.alafasy': 'https://server8.mp3quran.net/afs',
                'ar.abdulbasitmurattal': 'https://server7.mp3quran.net/basit',
                'ar.husary': 'https://server8.mp3quran.net/afs',
                'ar.minshawi': 'https://server10.mp3quran.net/minsh',
                'ar.shaatree': 'https://server11.mp3quran.net/shatri'
            };
            
            const baseUrl = reciterMap[currentReciter] || reciterMap['ar.alafasy'];
            audio.src = `${baseUrl}/${surahNum}.mp3`;
            
            console.log('Loading audio from:', audio.src);
            
            // Add error handling
            audio.onerror = function() {
                console.error('Failed to load audio from:', audio.src);
                showNotification('❌ فشل تحميل الصوت - تحقق من الاتصال بالإنترنت');
            };
            
            audio.onloadeddata = function() {
                console.log('Audio loaded successfully');
                showNotification('✅ تم تحميل الصوت بنجاح');
            };
        }

        function changeReciter() {
            currentReciter = document.getElementById('reciter-select').value;
            updateAudioSource();
        }

        async function loadSurahText(surahNumber) {
            const container = document.getElementById('ayat-container');
            container.innerHTML = '<div class="loading">⏳ جاري تحميل الآيات...</div>';
            
            try {
                const url = `https://api.alquran.cloud/v1/surah/${surahNumber}`;
                console.log('Fetching surah text from:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('Surah text response:', data);
                
                if (data.code === 200) {
                    container.innerHTML = '';
                    data.data.ayahs.forEach(ayah => {
                        const ayahDiv = document.createElement('div');
                        ayahDiv.className = 'ayah';
                        ayahDiv.innerHTML = `
                            ${ayah.text}
                            <span class="ayah-number">${ayah.numberInSurah}</span>
                        `;
                        container.appendChild(ayahDiv);
                    });
                    showNotification('✅ تم تحميل الآيات بنجاح');
                } else {
                    throw new Error('Failed to load surah text');
                }
            } catch (error) {
                console.error('Error loading surah text:', error);
                container.innerHTML = '<div class="loading">⚠️ يرجى الاتصال بالإنترنت لعرض النص<br>يمكنك الاستماع للصوت بدون النص</div>';
                showNotification('⚠️ فشل تحميل النص - الصوت متاح');
            }
        }

        // Adhkar Data
        const adhkarData = {
            morning: [
                {
                    text: 'أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ',
                    translation: 'أصبحنا وأصبح الملك لله، والحمد لله، ولا إله إلا الله وحده لا شريك له',
                    count: 1
                },
                {
                    text: 'اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ',
                    translation: 'اللهم بك أصبحنا وبك أمسينا وبك نحيا وبك نموت وإليك النشور',
                    count: 1
                },
                {
                    text: 'سُبْحَانَ اللَّهِ وَبِحَمْدِهِ',
                    translation: 'سبحان الله وبحمده',
                    count: 100
                },
                {
                    text: 'أَسْتَغْفِرُ اللَّهَ وَأَتُوبُ إِلَيْهِ',
                    translation: 'أستغفر الله وأتوب إليه',
                    count: 100
                }
            ],
            evening: [
                {
                    text: 'أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ',
                    translation: 'أمسينا وأمسى الملك لله، والحمد لله',
                    count: 1
                },
                {
                    text: 'اللَّهُمَّ بِكَ أَمْسَيْنَا، وَبِكَ أَصْبَحْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ الْمَصِيرُ',
                    translation: 'اللهم بك أمسينا وبك أصبحنا',
                    count: 1
                },
                {
                    text: 'سُبْحَانَ اللَّهِ وَبِحَمْدِهِ',
                    translation: 'سبحان الله وبحمده',
                    count: 100
                }
            ],
            sleep: [
                {
                    text: 'بِاسْمِكَ اللَّهُمَّ أَمُوتُ وَأَحْيَا',
                    translation: 'باسمك اللهم أموت وأحيا',
                    count: 1
                },
                {
                    text: 'اللَّهُمَّ قِنِي عَذَابَكَ يَوْمَ تَبْعَثُ عِبَادَكَ',
                    translation: 'اللهم قني عذابك يوم تبعث عبادك',
                    count: 3
                },
                {
                    text: 'آمَنَ الرَّسُولُ بِمَا أُنزِلَ إِلَيْهِ مِن رَّبِّهِ وَالْمُؤْمِنُونَ ۚ كُلٌّ آمَنَ بِاللَّهِ وَمَلَائِكَتِهِ وَكُتُبِهِ وَرُسُلِهِ',
                    translation: 'آخر آيتين من سورة البقرة',
                    count: 1
                }
            ],
            'after-prayer': [
                {
                    text: 'أَسْتَغْفِرُ اللَّهَ',
                    translation: 'أستغفر الله',
                    count: 3
                },
                {
                    text: 'اللَّهُمَّ أَنْتَ السَّلَامُ وَمِنْكَ السَّلَامُ تَبَارَكْتَ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ',
                    translation: 'اللهم أنت السلام ومنك السلام',
                    count: 1
                },
                {
                    text: 'سُبْحَانَ اللَّهِ',
                    translation: 'سبحان الله',
                    count: 33
                },
                {
                    text: 'الْحَمْدُ لِلَّهِ',
                    translation: 'الحمد لله',
                    count: 33
                },
                {
                    text: 'اللَّهُ أَكْبَرُ',
                    translation: 'الله أكبر',
                    count: 34
                }
            ]
        };

        function showAdhkar(category) {
            // Update active button
            document.querySelectorAll('.adhkar-category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const container = document.getElementById('adhkar-content');
            container.innerHTML = '';
            
            const adhkarList = adhkarData[category];
            adhkarList.forEach((dhikr, index) => {
                const card = document.createElement('div');
                card.className = 'dhikr-card';
                card.innerHTML = `
                    <div class="dhikr-text">${dhikr.text}</div>
                    <div class="dhikr-translation">${dhikr.translation}</div>
                    <div class="dhikr-counter-container">
                        <button class="dhikr-count-btn" onclick="countDhikr(this, ${dhikr.count})">
                            ذكر (${dhikr.count})
                        </button>
                    </div>
                    <div class="dhikr-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span class="count-text">0/${dhikr.count}</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function countDhikr(btn, max) {
            const card = btn.closest('.dhikr-card');
            const progressFill = card.querySelector('.progress-fill');
            const countText = card.querySelector('.count-text');
            
            let currentCount = parseInt(countText.textContent.split('/')[0]);
            currentCount = Math.min(currentCount + 1, max);
            
            const percentage = (currentCount / max) * 100;
            progressFill.style.width = percentage + '%';
            countText.textContent = `${currentCount}/${max}`;
            
            if (currentCount === max) {
                btn.textContent = '✓ مكتمل';
                btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                setTimeout(() => {
                    // Reset after 2 seconds
                    progressFill.style.width = '0%';
                    countText.textContent = `0/${max}`;
                    btn.textContent = `ذكر (${max})`;
                    btn.style.background = '';
                }, 2000);
            }
        }

        // Qibla Functions
        function findQibla() {
            if (!navigator.geolocation) {
                showNotification('❌ المتصفح لا يدعم تحديد الموقع');
                return;
            }

            showNotification('⏳ جاري تحديد موقعك...');

            navigator.geolocation.getCurrentPosition((position) => {
                const { latitude, longitude } = position.coords;
                const qiblaAngle = calculateQiblaDirection(latitude, longitude);
                
                document.getElementById('qibla-degree').textContent = Math.round(qiblaAngle) + '°';
                
                // Rotate compass
                const compassInner = document.getElementById('compass-inner');
                
                // Check if device supports orientation
                if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    // iOS 13+ requires permission
                    DeviceOrientationEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                window.addEventListener('deviceorientation', handleOrientation);
                            } else {
                                compassInner.style.transform = `rotate(${qiblaAngle}deg)`;
                                showNotification('✅ اتجاه القبلة: ' + Math.round(qiblaAngle) + '° شمال');
                            }
                        })
                        .catch(() => {
                            compassInner.style.transform = `rotate(${qiblaAngle}deg)`;
                            showNotification('✅ اتجاه القبلة: ' + Math.round(qiblaAngle) + '° شمال');
                        });
                } else if (window.DeviceOrientationEvent) {
                    // Try to use device orientation
                    window.addEventListener('deviceorientation', handleOrientation);
                    setTimeout(() => {
                        if (!compassInner.style.transform.includes('rotate')) {
                            compassInner.style.transform = `rotate(${qiblaAngle}deg)`;
                        }
                    }, 1000);
                    showNotification('✅ تم تحديد اتجاه القبلة');
                } else {
                    // Static display
                    compassInner.style.transform = `rotate(${qiblaAngle}deg)`;
                    showNotification('✅ اتجاه القبلة: ' + Math.round(qiblaAngle) + '° شمال');
                }
                
                function handleOrientation(event) {
                    const heading = event.alpha || 0;
                    const adjustedAngle = qiblaAngle - heading;
                    compassInner.style.transform = `rotate(${adjustedAngle}deg)`;
                }
                
            }, (error) => {
                console.error('Geolocation error:', error);
                let errorMsg = '❌ فشل تحديد الموقع';
                
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMsg = '❌ يرجى السماح بالوصول للموقع';
                        showHelpModal();
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMsg = '❌ الموقع غير متاح';
                        break;
                    case error.TIMEOUT:
                        errorMsg = '⏱️ انتهت مهلة تحديد الموقع';
                        break;
                }
                
                showNotification(errorMsg);
            }, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            });
        }

        function calculateQiblaDirection(lat, lng) {
            // Kaaba coordinates
            const kaabaLat = 21.4225;
            const kaabaLng = 39.8262;
            
            const phiK = kaabaLat * Math.PI / 180.0;
            const lambdaK = kaabaLng * Math.PI / 180.0;
            const phi = lat * Math.PI / 180.0;
            const lambda = lng * Math.PI / 180.0;
            const psi = 180.0 / Math.PI * Math.atan2(Math.sin(lambdaK - lambda), Math.cos(phi) * Math.tan(phiK) - Math.sin(phi) * Math.cos(lambdaK - lambda));
            
            return Math.round(psi < 0 ? psi + 360 : psi);
        }

        // Tasbih Functions
        function incrementTasbih() {
            tasbihCount++;
            document.getElementById('tasbih-count').textContent = tasbihCount;
            
            // Vibration feedback
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            
            // Special notifications at milestones
            if (tasbihCount === 33 || tasbihCount === 100) {
                showNotification(`🎉 ماشاء الله! وصلت إلى ${tasbihCount}`);
            }
        }

        function resetTasbih() {
            tasbihCount = 0;
            document.getElementById('tasbih-count').textContent = tasbihCount;
        }

        function setTasbihText(text) {
            currentDhikrText = text;
            
            // Update all preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active-preset');
            });
            
            // Highlight the selected button
            event.target.classList.add('active-preset');
            
            // Update tasbih label
            document.getElementById('tasbih-label').textContent = text;
            
            showNotification(`✅ تم اختيار: ${text}`);
        }

        // Notification System
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.querySelector('.theme-icon');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                themeIcon.textContent = '☀️';
                localStorage.setItem('theme', 'light');
                showNotification('🌞 تم التبديل للوضع النهاري');
            } else {
                themeIcon.textContent = '🌙';
                localStorage.setItem('theme', 'dark');
                showNotification('🌙 تم التبديل للوضع الليلي');
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.querySelector('.theme-icon');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                if (themeIcon) themeIcon.textContent = '☀️';
            }
        }

        // Khatmah Functions
        function loadKhatmahProgress() {
            const khatmahData = JSON.parse(localStorage.getItem('khatmahProgress') || '{}');
            updateKhatmahStats(khatmahData);
            displayKhatmahSurahs(khatmahData);
        }

        function displayKhatmahSurahs(khatmahData) {
            const grid = document.getElementById('khatmah-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            surahs.forEach(surah => {
                const card = document.createElement('div');
                card.className = 'khatmah-surah-card';
                if (khatmahData[surah.number]) {
                    card.classList.add('completed');
                }
                
                card.onclick = () => toggleKhatmahSurah(surah.number);
                
                card.innerHTML = `
                    <div class="khatmah-surah-name">${surah.name}</div>
                    <div class="khatmah-surah-info">${surah.verses} آية</div>
                `;
                
                grid.appendChild(card);
            });
        }

        function toggleKhatmahSurah(surahNumber) {
            let khatmahData = JSON.parse(localStorage.getItem('khatmahProgress') || '{}');
            
            if (khatmahData[surahNumber]) {
                delete khatmahData[surahNumber];
                showNotification(`تم إلغاء تحديد السورة`);
            } else {
                khatmahData[surahNumber] = true;
                showNotification(`✅ تم إكمال السورة! بارك الله فيك`);
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
            
            localStorage.setItem('khatmahProgress', JSON.stringify(khatmahData));
            updateKhatmahStats(khatmahData);
            displayKhatmahSurahs(khatmahData);
        }

        function updateKhatmahStats(khatmahData) {
            const completed = Object.keys(khatmahData).length;
            const total = 114;
            const percentage = Math.round((completed / total) * 100);
            
            // Calculate approximate pages (604 total pages in Quran)
            const totalPages = 604;
            const pagesCompleted = Math.round((completed / total) * totalPages);
            
            document.getElementById('khatmah-percent').textContent = percentage + '%';
            document.getElementById('khatmah-completed').textContent = `${completed}/${total}`;
            document.getElementById('khatmah-pages').textContent = `${pagesCompleted}/${totalPages}`;
            
            const progressFill = document.getElementById('khatmah-progress-fill');
            progressFill.style.width = percentage + '%';
            
            // Congratulations on completion
            if (completed === total) {
                showNotification('🎉 مبروك! لقد أكملت ختمة القرآن الكريم! اللهم تقبل منا ومنك');
            }
        }

        function resetKhatmah() {
            if (confirm('هل أنت متأكد من بدء ختمة جديدة؟ سيتم حذف التقدم الحالي.')) {
                localStorage.removeItem('khatmahProgress');
                loadKhatmahProgress();
                showNotification('🔄 تم بدء ختمة جديدة');
            }
        }

        function shareKhatmah() {
            const khatmahData = JSON.parse(localStorage.getItem('khatmahProgress') || '{}');
            const completed = Object.keys(khatmahData).length;
            const percentage = Math.round((completed / 114) * 100);
            
            const shareText = `📗 تقدمي في ختمة القرآن الكريم:
✅ أكملت ${completed} من 114 سورة
📊 نسبة الإنجاز: ${percentage}%

بارك الله فيّ وتقبل مني 🤲
#ختمة_القرآن #كريم`;

            // Try to use Web Share API
            if (navigator.share) {
                navigator.share({
                    title: 'تقدمي في ختمة القرآن',
                    text: shareText
                }).then(() => {
                    showNotification('✅ تم المشاركة بنجاح');
                }).catch(() => {
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showNotification('📋 تم النسخ! يمكنك الآن المشاركة');
        }

        // Duaa Data
        const duaaData = {
            daily: [
                {
                    title: 'دعاء الصباح',
                    text: 'اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ',
                    translation: 'اللهم بك أصبحنا وبك أمسينا وبك نحيا وبك نموت وإليك النشور',
                    source: 'الترمذي'
                },
                {
                    title: 'دعاء الخروج من المنزل',
                    text: 'بِسْمِ اللَّهِ، تَوَكَّلْتُ عَلَى اللَّهِ، لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ',
                    translation: 'باسم الله، توكلت على الله، لا حول ولا قوة إلا بالله',
                    source: 'أبو داود والترمذي'
                },
                {
                    title: 'دعاء دخول المنزل',
                    text: 'اللَّهُمَّ إِنِّي أَسْأَلُكَ خَيْرَ الْمَوْلِجِ وَخَيْرَ الْمَخْرَجِ، بِسْمِ اللَّهِ وَلَجْنَا، وَبِسْمِ اللَّهِ خَرَجْنَا، وَعَلَى اللَّهِ رَبِّنَا تَوَكَّلْنَا',
                    translation: 'اللهم إني أسألك خير المولج وخير المخرج',
                    source: 'أبو داود'
                }
            ],
            quran: [
                {
                    title: 'دعاء الهداية',
                    text: 'رَبَّنَا لَا تُزِغْ قُلُوبَنَا بَعْدَ إِذْ هَدَيْتَنَا وَهَبْ لَنَا مِن لَّدُنكَ رَحْمَةً ۚ إِنَّكَ أَنتَ الْوَهَّابُ',
                    translation: 'ربنا لا تزغ قلوبنا بعد إذ هديتنا وهب لنا من لدنك رحمة إنك أنت الوهاب',
                    source: 'سورة آل عمران: 8'
                },
                {
                    title: 'دعاء الفرج',
                    text: 'رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ',
                    translation: 'ربنا آتنا في الدنيا حسنة وفي الآخرة حسنة وقنا عذاب النار',
                    source: 'سورة البقرة: 201'
                },
                {
                    title: 'دعاء المغفرة',
                    text: 'رَبَّنَا ظَلَمْنَا أَنفُسَنَا وَإِن لَّمْ تَغْفِرْ لَنَا وَتَرْحَمْنَا لَنَكُونَنَّ مِنَ الْخَاسِرِينَ',
                    translation: 'ربنا ظلمنا أنفسنا وإن لم تغفر لنا وترحمنا لنكونن من الخاسرين',
                    source: 'سورة الأعراف: 23'
                }
            ],
            prophet: [
                {
                    title: 'دعاء الكرب',
                    text: 'لَا إِلَهَ إِلَّا اللَّهُ الْعَظِيمُ الْحَلِيمُ، لَا إِلَهَ إِلَّا اللَّهُ رَبُّ الْعَرْشِ الْعَظِيمِ، لَا إِلَهَ إِلَّا اللَّهُ رَبُّ السَّمَوَاتِ وَرَبُّ الْأَرْضِ وَرَبُّ الْعَرْشِ الْكَرِيمِ',
                    translation: 'لا إله إلا الله العظيم الحليم، لا إله إلا الله رب العرش العظيم...',
                    source: 'متفق عليه'
                },
                {
                    title: 'دعاء الهم والحزن',
                    text: 'اللَّهُمَّ إِنِّي عَبْدُكَ، ابْنُ عَبْدِكَ، ابْنُ أَمَتِكَ، نَاصِيَتِي بِيَدِكَ، مَاضٍ فِيَّ حُكْمُكَ، عَدْلٌ فِيَّ قَضَاؤُكَ، أَسْأَلُكَ بِكُلِّ اسْمٍ هُوَ لَكَ سَمَّيْتَ بِهِ نَفْسَكَ، أَوْ أَنْزَلْتَهُ فِي كِتَابِكَ، أَوْ عَلَّمْتَهُ أَحَدًا مِنْ خَلْقِكَ، أَوِ اسْتَأْثَرْتَ بِهِ فِي عِلْمِ الْغَيْبِ عِنْدَكَ، أَنْ تَجْعَلَ الْقُرْآنَ رَبِيعَ قَلْبِي، وَنُورَ صَدْرِي، وَجِلَاءَ حُزْنِي، وَذَهَابَ هَمِّي',
                    translation: 'اللهم إني عبدك ابن عبدك ابن أمتك... أن تجعل القرآن ربيع قلبي ونور صدري وجلاء حزني وذهاب همي',
                    source: 'مسند أحمد'
                }
            ],
            special: [
                {
                    title: 'دعاء السفر',
                    text: 'سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ، وَإِنَّا إِلَى رَبِّنَا لَمُنْقَلِبُونَ، اللَّهُمَّ إِنَّا نَسْأَلُكَ فِي سَفَرِنَا هَذَا الْبِرَّ وَالتَّقْوَى، وَمِنَ الْعَمَلِ مَا تَرْضَى',
                    translation: 'سبحان الذي سخر لنا هذا وما كنا له مقرنين...',
                    source: 'مسلم والترمذي'
                },
                {
                    title: 'دعاء المطر',
                    text: 'اللَّهُمَّ صَيِّبًا نَافِعًا',
                    translation: 'اللهم صيباً نافعاً - أي مطراً نافعاً',
                    source: 'البخاري'
                },
                {
                    title: 'دعاء الامتحان',
                    text: 'اللَّهُمَّ لَا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الْحَزْنَ إِذَا شِئْتَ سَهْلًا',
                    translation: 'اللهم لا سهل إلا ما جعلته سهلاً',
                    source: 'ابن حبان'
                }
            ]
        };

        function showDuaaCategory(category) {
            // Update active button
            document.querySelectorAll('.duaa-category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const container = document.getElementById('duaa-content');
            container.innerHTML = '';
            
            const duaas = duaaData[category];
            duaas.forEach(duaa => {
                const card = document.createElement('div');
                card.className = 'duaa-card';
                card.innerHTML = `
                    <div class="duaa-title">${duaa.title}</div>
                    <div class="duaa-text">${duaa.text}</div>
                    <div class="duaa-translation">${duaa.translation}</div>
                    <div class="duaa-source">المصدر: ${duaa.source}</div>
                    <div class="duaa-actions">
                        <button class="duaa-action-btn" onclick="copyDuaa(\`${duaa.text}\`)">📋 نسخ</button>
                        <button class="duaa-action-btn" onclick="shareDuaa(\`${duaa.title}\`, \`${duaa.text}\`)">📤 مشاركة</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function copyDuaa(text) {
            copyToClipboard(text);
        }

        function shareDuaa(title, text) {
            const shareText = `${title}\n\n${text}\n\n🤲 من تطبيق كريم`;
            
            if (navigator.share) {
                navigator.share({
                    title: title,
                    text: shareText
                }).then(() => {
                    showNotification('✅ تم المشاركة بنجاح');
                }).catch(() => {
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        // Welcome Modal Functions - REMOVED, direct browser request instead
        function requestLocationPermission() {
            // This will trigger the browser's native location permission prompt
            getPrayerTimes();
        }

        // Hijri Date Function
        async function getHijriDate() {
            try {
                const today = new Date();
                const dateStr = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
                const response = await fetch(`https://api.aladhan.com/v1/gToH/${dateStr}`);
                const data = await response.json();
                
                if (data.code === 200) {
                    const hijri = data.data.hijri;
                    const gregorian = data.data.gregorian;
                    const hijriDateText = `📅 ${hijri.day} ${hijri.month.ar} ${hijri.year} هـ - ${gregorian.day} ${getArabicMonth(gregorian.month.number)} ${gregorian.year} م`;
                    document.getElementById('hijri-date').textContent = hijriDateText;
                }
            } catch (error) {
                console.error('Error fetching Hijri date:', error);
                document.getElementById('hijri-date').textContent = '📅 التاريخ الهجري غير متاح';
            }
        }

        function getArabicMonth(monthNumber) {
            const months = ['يناير', 'فبراير', 'مارس', 'إبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
            return months[monthNumber - 1];
        }

        // Prayer Tracker Functions
        function updatePrayerTracker(prayer, checked) {
            const today = new Date().toDateString();
            let trackerData = JSON.parse(localStorage.getItem('prayerTracker') || '{}');
            
            if (!trackerData[today]) {
                trackerData[today] = {};
            }
            
            trackerData[today][prayer] = checked;
            localStorage.setItem('prayerTracker', JSON.stringify(trackerData));
            
            // Update card style
            const card = document.querySelector(`.tracker-prayer-card[data-prayer="${prayer}"]`);
            if (checked) {
                card.classList.add('completed');
                // Vibration feedback
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
                showNotification(`✅ تم تسجيل صلاة ${getPrayerNameArabic(prayer)}`);
            } else {
                card.classList.remove('completed');
            }
            
            updateTrackerStats();
        }

        function getPrayerNameArabic(prayer) {
            const names = {
                'fajr': 'الفجر',
                'dhuhr': 'الظهر',
                'asr': 'العصر',
                'maghrib': 'المغرب',
                'isha': 'العشاء'
            };
            return names[prayer];
        }

        function updateTrackerStats() {
            const today = new Date().toDateString();
            const trackerData = JSON.parse(localStorage.getItem('prayerTracker') || '{}');
            const todayData = trackerData[today] || {};
            
            // Count prayed
            let prayedCount = 0;
            Object.values(todayData).forEach(val => {
                if (val) prayedCount++;
            });
            
            document.getElementById('prayed-count').textContent = prayedCount;
            document.getElementById('remaining-count').textContent = 5 - prayedCount;
            
            // Calculate streak
            let streak = 0;
            const dates = Object.keys(trackerData).sort().reverse();
            for (let dateStr of dates) {
                const dayData = trackerData[dateStr];
                const completedCount = Object.values(dayData).filter(v => v).length;
                if (completedCount === 5) {
                    streak++;
                } else {
                    break;
                }
            }
            document.getElementById('streak-count').textContent = streak;
            
            // Update week grid
            updateWeekGrid(trackerData);
        }

        function updateWeekGrid(trackerData) {
            const weekGrid = document.getElementById('week-grid');
            weekGrid.innerHTML = '';
            
            const arabicDays = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                const dayData = trackerData[dateStr] || {};
                const completedCount = Object.values(dayData).filter(v => v).length;
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                if (completedCount === 5) {
                    dayCard.classList.add('full-day');
                }
                
                const dayName = arabicDays[date.getDay()];
                const dayDate = `${date.getDate()}/${date.getMonth() + 1}`;
                
                dayCard.innerHTML = `
                    <div class="day-name">${dayName}</div>
                    <div class="day-date">${dayDate}</div>
                    <div class="day-count">${completedCount}/5</div>
                `;
                
                weekGrid.appendChild(dayCard);
            }
        }

        function loadTrackerData() {
            const today = new Date().toDateString();
            const trackerData = JSON.parse(localStorage.getItem('prayerTracker') || '{}');
            const todayData = trackerData[today] || {};
            
            // Update checkboxes
            Object.keys(todayData).forEach(prayer => {
                const checkbox = document.querySelector(`.tracker-prayer-card[data-prayer="${prayer}"] input`);
                if (checkbox) {
                    checkbox.checked = todayData[prayer];
                    if (todayData[prayer]) {
                        checkbox.closest('.tracker-prayer-card').classList.add('completed');
                    }
                }
            });
            
            updateTrackerStats();
        }

        function syncTrackerTimes(timings) {
            if (!timings) return;
            
            const prayerMap = {
                'Fajr': 'fajr',
                'Dhuhr': 'dhuhr',
                'Asr': 'asr',
                'Maghrib': 'maghrib',
                'Isha': 'isha'
            };
            
            Object.entries(prayerMap).forEach(([key, id]) => {
                const timeElement = document.getElementById(`tracker-${id}-time`);
                if (timeElement && timings[key]) {
                    timeElement.textContent = timings[key];
                }
            });
        }

        // Help Modal Functions
        function showHelpModal() {
            document.getElementById('help-modal').classList.add('active');
        }

        function closeHelpModal() {
            document.getElementById('help-modal').classList.remove('active');
        }

        async function useManualLocation() {
            const lat = parseFloat(document.getElementById('manual-lat').value);
            const lng = parseFloat(document.getElementById('manual-lng').value);

            if (isNaN(lat) || isNaN(lng)) {
                showNotification('❌ يرجى إدخال إحداثيات صحيحة');
                return;
            }

            if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
                showNotification('❌ الإحداثيات غير صحيحة');
                return;
            }

            await fetchPrayerTimesForLocation(lat, lng, 'يدوي');
        }

        function selectCity() {
            const select = document.getElementById('city-select');
            const value = select.value;
            
            if (!value) return;
            
            const [lat, lng] = value.split(',').map(parseFloat);
            const cityName = select.options[select.selectedIndex].text;
            
            fetchPrayerTimesForLocation(lat, lng, cityName);
        }

        async function fetchPrayerTimesForLocation(lat, lng, locationName) {
            closeHelpModal();
            
            const locationText = document.getElementById('location-text');
            locationText.innerHTML = `📍 ${locationName} (${lat.toFixed(4)}°, ${lng.toFixed(4)}°)`;

            // Calculate prayer times
            const date = new Date();
            const dateStr = `${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}`;
            
            try {
                const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lng}&method=5`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.code === 200) {
                    const timings = data.data.timings;
                    displayPrayerTimes(timings);
                    
                    // Cache prayer times
                    localStorage.setItem('prayerTimes', JSON.stringify(timings));
                    localStorage.setItem('prayerTimesDate', dateStr);
                    localStorage.setItem('prayerLocation', `${locationName}`);
                    
                    showNotification('✅ تم تحديث مواقيت الصلاة بنجاح');
                }
            } catch (error) {
                showNotification('❌ فشل تحميل مواقيت الصلاة');
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            loadTheme();
            displaySurahs();
            showAdhkar('morning');
            showDuaaCategory('daily');
            getHijriDate();
            loadTrackerData();
            loadKhatmahProgress();
            
            // Register Service Worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKGUpID0+IHsKICBjb25zb2xlLmxvZygnU2VydmljZSBXb3JrZXIgaW5zdGFsbGVkJyk7CiAgc2VsZi5za2lwV2FpdGluZygpOwp9KTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCAoZSkgPT4gewogIGNvbnNvbGUubG9nKCdTZXJ2aWNlIFdvcmtlciBhY3RpdmF0ZWQnKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgKGUpID0+IHsKICBlLnJlc3BvbmRXaXRoKAogICAgZmV0Y2goZS5yZXF1ZXN0KS5jYXRjaCgoKSA9PiB7CiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoJ09mZmxpbmUnLCB7IHN0YXR1czogNTAzIH0pOwogICAgfSkKICApOwp9KTs=')
                    .then(() => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            }
            
            // Show install prompt for PWA
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install notification after 5 seconds
                setTimeout(() => {
                    if (deferredPrompt) {
                        showNotification('💡 يمكنك تثبيت كريم كتطبيق على جهازك!');
                        
                        // Auto-trigger install prompt
                        setTimeout(() => {
                            deferredPrompt.prompt();
                            deferredPrompt.userChoice.then((choiceResult) => {
                                if (choiceResult.outcome === 'accepted') {
                                    showNotification('✅ شكراً! تم تثبيت التطبيق');
                                }
                                deferredPrompt = null;
                            });
                        }, 3000);
                    }
                }, 5000);
            });
            
            // Request notification permission for prayer alerts
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            showNotification('✅ تم تفعيل تنبيهات مواعيد الصلاة');
                        }
                    });
                }, 3000);
            }
            
            // Check for cached prayer times first
            const cachedTimes = localStorage.getItem('prayerTimes');
            if (cachedTimes) {
                const cachedDate = localStorage.getItem('prayerTimesDate');
                const today = new Date();
                const todayStr = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
                
                if (cachedDate === todayStr) {
                    displayPrayerTimes(JSON.parse(cachedTimes));
                    const cachedLocation = localStorage.getItem('prayerLocation');
                    if (cachedLocation) {
                        document.getElementById('location-text').innerHTML = `📍 ${cachedLocation} (محفوظ)`;
                    }
                }
            }
            
            // CRITICAL: Request location permission immediately - this triggers browser native prompt
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        // Success - get prayer times
                        const { latitude, longitude } = position.coords;
                        document.getElementById('location-text').innerHTML = `📍 ${latitude.toFixed(4)}° , ${longitude.toFixed(4)}°`;
                        
                        const date = new Date();
                        const dateStr = `${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}`;
                        
                        try {
                            const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${latitude}&longitude=${longitude}&method=5`;
                            const response = await fetch(url);
                            const data = await response.json();
                            
                            if (data.code === 200) {
                                const timings = data.data.timings;
                                displayPrayerTimes(timings);
                                localStorage.setItem('prayerTimes', JSON.stringify(timings));
                                localStorage.setItem('prayerTimesDate', dateStr);
                                localStorage.setItem('prayerLocation', `${latitude},${longitude}`);
                                showNotification('✅ تم تحديث مواقيت الصلاة بنجاح');
                            }
                        } catch (error) {
                            console.error('Error fetching prayer times:', error);
                        }
                    },
                    (error) => {
                        // Error - show message
                        console.error('Geolocation error:', error);
                        let errorMsg = '❌ يرجى السماح بالوصول للموقع من إعدادات المتصفح';
                        if (error.code === 1) {
                            errorMsg = '❌ تم رفض الإذن - يرجى السماح بالوصول للموقع';
                        }
                        document.getElementById('location-text').innerHTML = errorMsg;
                        showNotification(errorMsg);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('quran-modal');
            if (event.target === modal) {
                closeQuranModal();
            }
            
            const helpModal = document.getElementById('help-modal');
            if (event.target === helpModal) {
                closeHelpModal();
            }
        }
    </script>
</body>
</html>
